{% macro form_group(field, label_size="2", input_size="8",
                    class_="", options={}) %}

  {% if field.type == 'HiddenField' %}

    {{ field(class_=cls, **options) }}

  {% else %}

    {% set label_cls = "col-sm-" + label_size  + " control-label" %}

    <div class="form-group {% if field.errors %}has-error{% endif %}">
      <label class="{{ label_cls }}" for="{{ field.id }}">
        {{ field.label.text }}
        {% if field.flags.required %}
          <span class="text-danger">*</span>
        {% endif %}
      </label>
      {% if field.type not in (
          'CustomFileField', 'BooleanField', 'CustomBooleanField',
          'MultiCheckboxField', 'RadioField',
          'CategoryField') and not css_clean %}
        {% set cls = "form-control " + class_ %}
      {% else %}
        {% set cls = class_ %}
      {% endif %}
      <div class="col-sm-{{ input_size }}">
        {{ field(class_=cls, placeholder=field.label.text, **options) }}
        {% if field.description %}
          <div class="help-block">{{ field.description | urlize }}</div>
        {% endif %}
        {% if field.errors %}
          <div class="text-danger"><small>{{ field.errors[0] }}</small></div>
        {% endif %}
      </div>
    </div> {# form-group #}

  {% endif %}

{% endmacro %}


{% macro static_form_group(label, value) %}

  <div class="form-group">
    <label class="col-sm-2 control-label"> {{ label }} </label>

    <div class="col-sm-10">
      <p class="form-control-static">{{ value }}</p>
    </div>
  </div> {# form-group #}

{% endmacro %}


{% macro breadcrumb(crumbs) %}

  <ol class="breadcrumb">
    {% for crumb in crumbs %}
      <li class="{% if loop.last %}active{% endif %}">
        {% if not loop.last %}
          <a href="{{ crumb[0] }}">{{ crumb[1] }}</a>
        {% else %}
         {{ crumb[1] }}
        {% endif %}
      </li>
    {% endfor %}
  </ol>

{% endmacro %}


{% macro row_link(link) %}

  <div class="row-link">
    <a href="{{ link[0] }}" class="label label-danger">
      {{ link[1] }}</a>
  </div>

{% endmacro %}

{% macro activity_url(activity) %}
  {% if activity.participant.deleted %}
    <span class="delete">deleted /
      <a data-toggle="restore"
         data-href="{{ url_for('.participant_restore', participant_id=activity.participant.id) }}"
         data-message="Are you sure you want to restore this participant?">Restore
      <small style="position:relative; right: -2px;">
        <span class="glyphicon glyphicon-repeat"></span>
      </small></a>
    </span>
  {% else %}
    {% set url = activity.participant.get_absolute_url() %}
    <a href="{{ url }}"><span class="glyphicon glyphicon-arrow-right"></span></a>
  {% endif %}
{% endmacro %}


{% macro flashed_messages() -%}

  {% for categ, msg in get_flashed_messages(with_categories=True) %}
    <div class="alert alert-{{ categ }} center-block" role="alert">
      {{ msg|safe }}</div>
  {% endfor %}

{%- endmacro %}


{% macro list_inputs(inputs) %}

  <ul class="list-unstyled row">
    {% for input in inputs %}
      <li class="col-sm-{{ (12 / inputs|length) | int }}">
        {{ input.label }}
        {% if input.flags.required %}
          <span class="text-danger">*</span>
        {% endif %}
        {{ input(class_="form-control",
                 placeholder=input.label.text) }}
        {% if input.errors %}
          <div class="text-danger">
            <small>{{ input.errors[0] }}</small>
          </div>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

{% endmacro %}


{% macro form_group_with_list_inputs(field, label_size="2",
                                     input_size="8") %}

  {% set label_cls = "col-sm-" + label_size  + " control-label" %}

  <div class="form-group {% if field.errors %}has-error{% endif %}">
    <label class="{{ label_cls }}" for="{{ field.id }}">
      {{ field.label.text }}
      {% if field.flags.required %}
        <span class="text-danger">*</span>
      {% endif %}
    </label>

    <div class="col-sm-{{ input_size }}">
      <div class="panel panel-default">
        <div class="panel-body">
          {{ list_inputs(field.translations) }}
        </div>
      </div>
    </div>
  </div> {# form-group #}

{% endmacro %}


{% macro render_pagination(pagination, endpoint, extra={}) %}

  <ul class="pagination">

    {% if pagination.has_prev %}
      <li><a href="{{ url_for(endpoint,
                              page=pagination.prev().page,
                              **extra) }}">&laquo;</a></li>
    {% else %}
      <li class="disabled"><a>&laquo;</a></li>
    {% endif %}

    {%- for page in pagination.iter_pages() %}
      {% if page %}
        {% if page != pagination.page %}
          <li>
            <a href="{{ url_for(endpoint, page=page, **extra) }}">
              {{ page }}</a>
          </li>
        {% else %}
          <li class="active"><a>{{ page }}</a></li>
        {% endif %}
      {% else %}
        <li class="disabled">
          <span class="ellipsis">â€¦</span>
        </li>
      {% endif %}

    {%- endfor %}

    {% if pagination.has_next %}
      <li><a href="{{ url_for(endpoint,
                              page=pagination.next().page,
                              **extra) }}">&raquo;</a></li>
    {% else %}
      <li class="disabled"><a>&raquo;</a></li>
    {% endif %}

  </ul>

{% endmacro %}


{% macro meeting_title_for_printouts() %}

  {{ g.meeting.title }} <br>
  {{ g.meeting.venue_city.english }}
  ({{ g.meeting.venue_country }}) {{ g.meeting.venue_state }},
  {{ date_processor(g.meeting.date_start, g.meeting.date_end) }}

{% endmacro %}


{% macro custom_fields_box_edit(form, field_type, title) %}

  {% if form.has(field_type) %}
    <div class="col-sm-3">
      <div class="panel panel-default">
        <div class="panel-heading"><b>{{ title }}</b></div>
        <div class="panel-body" id="{{ title }}">
          {% for field in form.filter([field_type]) %}
            {{ form_group(field, label_size="6", input_size="6") }}
          {% endfor %}
        </div>
      </div> {# panel #}
    </div> {# col-sm-3 #}
  {% endif %}

{% endmacro %}


{% macro custom_fields_box_view(form, field_type, title) %}

  {% if form.has(field_type) %}
    <h5>{{ title }}</h5>
    <div class="table-responsive">
      <table class="table table-bordered table-condensed table-striped"
             id="{{ title }}">
        <tbody>
          {% for field in form.filter([field_type]) %}
            <tr>
              <th class="col-sm-5">{{ field.label.text }}</th>
              <td>
                {% if field.data %}
                  <span class="glyphicon glyphicon-ok"></span>
                {% else %}
                  <span class="glyphicon glyphicon-minus"></span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div> {# table-responsive #}
  {% endif %}

{% endmacro %}


{% macro event_fields_box_view(form, field_type, title) %}

  {% if form.has(field_type) %}
    <h5>{{ title }}</h5>
    <div class="table-responsive">
      <table class="table table-bordered table-condensed table-striped"
             id="{{ title }}">
        <tbody>
          {% for field in form.filter([field_type]) %}
            {% if field.data %}
            <tr>
              <th class="col-sm-5">{{ field.label.text }}</th>
            </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div> {# table-responsive #}
  {% endif %}

{% endmacro %}


{% macro form_photo_field(field, action_url) %}
  <div class="form-group {% if field.errors %}has-error{% endif %}">
    <label class="col-sm-2 control-label" for="{{ field.id }}">
      {{ field.label.text }}
    </label>

    <div class="col-sm-3">
      {{ field(class_="form-control") }}
      {% if field.errors %}
        <div class="text-danger"><small>{{ field.errors[0] }}</small></div>
      {% endif %}
    </div>

    <div class="actions">
      <a href="{{ action_url }}">
        <span class="glyphicon glyphicon-plus"></span>
        Add a new custom field
      </a>
    </div>
  </div>

{% endmacro %}


{% macro render_fields(fields, default=False) %}

  <p class="text-right"><small>{{ fields.count() }} fields</small></p>
  <table class="table table-bordered table-condensed sortable"
         data-url="{{ url_for('.custom_field_update_position') }}">

    <thead>
      <th class="handler"></th>
      <th>Label</th>
      <th>Type</th>
      {% if default %}
        <th>Meeting Types</th>
      {% endif %}
      <th>Required</th>
      <th class="text-right col-sm-3">Visible on registration form</th>
    </thead>

    <tbody>
      {% for field in fields %}
        {% set url = url_for('.custom_field_edit',
                             custom_field_id=field.id)%}
        <tr id="items-{{ field.id }}"
            class="{% if field.is_primary %}highlight{% endif %}">
          <td class="handler">
            <span class="glyphicon glyphicon-align-justify"></span>
          </td>
          <td class="field-label">
            {% if field.is_primary %}
              <b>{{ field.label }}</b>
            {% else %}
              <a href="{{ url }}">{{ field.label }}</a>
            {% endif %}
          </td>
          <td>{{ field.field_type.value }}</td>
          {% if default %}
            <td>
              <ul class="list-unstyled">
                {% for meeting_type in field.meeting_types %}
                  <li>- {{ meeting_type.slug }}</li>
                {% endfor %}
              </ul>
            </td>
          {% endif %}
          <td><span class="glyphicon {% if field.required %} glyphicon-ok {% else %} glyphicon-remove {% endif %}"></span></td>
          <td class="text-right"><span class="glyphicon {% if field.visible_on_registration_form %} glyphicon-ok {% else %} glyphicon-remove {% endif %}"></span></td>
        </tr>
      {% endfor %}
    </tbody>

  </table>

{% endmacro %}


{% macro actions(type) %}

    <div class="actions">
        {% set url = url_for('.custom_field_edit', custom_field_type=type) %}
        <a href="{{ url }}" class="btn btn-primary btn-sm">
        <span class="glyphicon glyphicon-pencil"></span> &nbsp;
        Add a new field</a>
    </div> {# actions #}

{% endmacro %}
