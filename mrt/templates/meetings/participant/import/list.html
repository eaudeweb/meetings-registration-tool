{% extends "meetings/_base.html" %}
{% from "_bits.html" import breadcrumb %}


{% block title %}Import participants{% endblock %}


{% block breadcrumb %}

  {{ breadcrumb( [
      ('', 'Import Participants')
  ] ) }}

{% endblock %}

{% block scripts %}
  <script>
	$(function () {
		$("#results-table").dataTable({
			scrollX: true
		});
	});
  </script>

{% endblock %}


{% block content %}

  {{ super() }}

  <div>
    {% if not has_errors and file_name %}
      <form method="POST" enctype="multipart/form-data" action="{{ url_for('.participants_import') }}">
        <input name="file_name" type="hidden" value="{{ file_name }}"/>
        <button class="btn btn-sm btn-success" name="action" value="import">
          Start import
        </button>
      </form>
    {% else %}
      Participants can be imported via an XLS file. First
      <form method="POST" action="{{ url_for('.participants_import_template') }}" style="display: inline">
        <button class="btn btn-sm btn-default" type="submit">
          <i class="glyphicon glyphicon-download"></i>Download the import template
        </button>
      </form>
      and fill in the participant data.
      <hr/>
      <p>Upload the XLS file back to import the data. You will get the chance to review the import results here.</p>
      <form method="POST" enctype="multipart/form-data" action="{{ url_for('.participants_import') }}">
        <input id="fileupload" name="import_file" type="file" style=""/>
        <button class="btn btn-sm btn-default" type="submit" name="action" value="upload">
          <i class="glyphicon glyphicon-upload"></i> Submit
        </button>
      </form>
      <hr/>
    {% endif %}
  </div>

  {% if all_fields %}
    <div class="table-responsive">
      <table id="results-table">
        <thead>
        <tr>
          {% for field in all_fields %}
            <th>{{ field.label.text }}</th>
          {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for form in forms %}
          <tr {% if form.errors %}class="bg-warning" {% else %}class="bg-success"{% endif %}>
            {% for field in all_fields %}
              <td
                  {% if form[field.id].errors %}
                    title="{{ '\n'.join(form[field.id].errors) }}"
                    data-toggle="tooltip" data-placement="top" data-container="body"
                    class="bg-danger"
                  {% endif %}
              >

                {{ form[field.id].render_data() }}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}

{% endblock %}
